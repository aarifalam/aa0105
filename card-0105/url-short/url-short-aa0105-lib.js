const themeToggle=document.getElementById("themeToggle"),themeIcon=themeToggle.querySelector("i"),themeText=themeToggle.querySelector("span"),prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)"),currentTheme=localStorage.getItem("theme")||(prefersDarkScheme.matches?"dark":"light");function updateThemeIcon(e){"dark"===e?(themeIcon.className="fas fa-moon",themeText.textContent="Dark Mode"):(themeIcon.className="fas fa-sun",themeText.textContent="Light Mode")}document.documentElement.setAttribute("data-theme",currentTheme),updateThemeIcon(currentTheme),themeToggle.addEventListener("click",()=>{let e=document.documentElement.getAttribute("data-theme"),t="dark"===e?"light":"dark";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),updateThemeIcon(t)}),document.querySelectorAll(".expiry-option").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".expiry-option").forEach(e=>e.classList.remove("active")),this.classList.add("active"),document.getElementById("expiryDays").value=this.getAttribute("data-days")})});const WORKER_API="https://url.aarif753alam.workers.dev";async function createShortURL(){let e=document.getElementById("longURL").value.trim(),t=document.getElementById("customKey").value.trim(),n=document.getElementById("expiryDays").value,a=document.getElementById("createBtn");if(document.getElementById("error").style.display="none",document.getElementById("resultContainer").style.display="none",document.getElementById("loadingContainer").style.display="block",document.getElementById("loadingText").textContent="Processing your URL...",document.getElementById("loadingSubtext").textContent="This may take a few seconds",a.disabled=!0,a.innerHTML='<i class="fas fa-spinner fa-spin"></i> Processing...',!e){showError("Please enter a destination URL."),resetButton();return}try{let r=new URL(e);if(!r.protocol||!r.hostname)throw Error("Invalid URL")}catch(o){showError("Please enter a valid URL (include http:// or https://)"),resetButton();return}try{let l=1,i=["Validating URL...","Checking availability...","Generating short link...","Finalizing..."],s=setInterval(()=>{l<i.length&&(document.getElementById("loadingText").textContent=i[l],l++)},800),c=await fetch(WORKER_API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({longURL:e,customKey:t||void 0,expiryDays:n})});clearInterval(s);let d=await c.json();if(document.getElementById("loadingContainer").style.display="none",a.disabled=!1,a.innerHTML='<i class="fas fa-bolt"></i> Create Short URL',!c.ok||!d.success){showError(d.error||"Failed to create short URL. Please try again.");return}displayResult(d)}catch(y){document.getElementById("loadingContainer").style.display="none",a.disabled=!1,a.innerHTML='<i class="fas fa-bolt"></i> Create Short URL',console.error("Error:",y),showError("Network error. Please check your connection and try again.")}}function resetButton(){let e=document.getElementById("createBtn");document.getElementById("loadingContainer").style.display="none",e.disabled=!1,e.innerHTML='<i class="fas fa-bolt"></i> Create Short URL'}function displayResult(e){let t=document.getElementById("resultContainer"),n=document.getElementById("shortURLDisplay"),a=document.getElementById("createdDate"),r=document.getElementById("expiryDate"),o=document.getElementById("clickCount");n.innerHTML=`<a href="${e.shortURL}" target="_blank">${e.shortURL}</a>`,o.textContent=e.clicks;let l=new Date(e.created);if(a.textContent=l.toLocaleDateString(),e.expiry){let i=new Date(e.expiry);r.textContent=i.toLocaleDateString()}else r.textContent="Never";window.shortURLData=e,t.style.display="block",setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}function showError(e){let t=document.getElementById("error");t.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${e}`,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3)}function clearForm(){document.getElementById("longURL").value="",document.getElementById("customKey").value="",document.getElementById("error").style.display="none",document.getElementById("resultContainer").style.display="none",document.getElementById("loadingContainer").style.display="none",document.querySelectorAll(".expiry-option").forEach(e=>e.classList.remove("active")),document.querySelector('.expiry-option[data-days="30"]').classList.add("active"),document.getElementById("expiryDays").value="30";let e=document.getElementById("createBtn");e.disabled=!1,e.innerHTML='<i class="fas fa-bolt"></i> Create Short URL'}function copyShortURL(){window.shortURLData&&navigator.clipboard.writeText(window.shortURLData.shortURL).then(()=>{let e=document.querySelector(".action-btn.copy"),t=e.innerHTML;e.innerHTML='<i class="fas fa-check"></i> Copied!',e.style.background="#00b09b",setTimeout(()=>{e.innerHTML=t,e.style.background=""},2e3)}).catch(e=>{showError("Failed to copy to clipboard")})}async function viewAnalytics(){if(window.shortURLData)try{let e=await fetch(`${WORKER_API}/analytics/${window.shortURLData.key}`),t=await e.json();if(t.success){let n=t.analytics;alert(`\xf0Ÿ“Š Analytics for: ${window.shortURLData.shortURL}

\xf0Ÿ“… Created: ${new Date(n.created).toLocaleString()}
\xf0Ÿ‘† Clicks: ${n.clicks}
\xe2\x8f\xb0 Last Accessed: ${n.lastAccessed?new Date(n.lastAccessed).toLocaleString():"Never"}
\xe2\x8f\xb3 Expires: ${n.expiry?new Date(n.expiry).toLocaleDateString():"Never"}

\xf0Ÿ”— Original URL: ${n.longURL.substring(0,50)}${n.longURL.length>50?"...":""}`)}else showError("Failed to fetch analytics")}catch(a){console.error("Analytics error:",a),showError("Error fetching analytics data")}}document.getElementById("longURL").addEventListener("keypress",function(e){"Enter"===e.key&&createShortURL()}),document.getElementById("customKey").addEventListener("input",function(e){this.value=this.value.toLowerCase().replace(/[^a-z0-9-_]/g,"-")}),document.addEventListener("DOMContentLoaded",function(){});
